// This file has been autogenerated from a class added in the UI designer.

using System;

using Foundation;
using UIKit;
using RangeSlider;
using ThisRoofN.ViewModels;
using CoreGraphics;
using MvvmCross.Binding.BindingContext;
using AllianceCustomPicker;
using System.Linq;

namespace ThisRoofN.iOS
{
	public partial class SearchView : BaseViewController
	{
		private TRMovingLabelRangeSlider mPriceRangeSlider;

		public SearchView (IntPtr handle) : base (handle)
		{
		}

		public SearchViewModel ViewModelInstance {
			get {
				return (SearchViewModel)base.ViewModel;
			}
		}

		public override void ViewDidLoad ()
		{
			base.ViewDidLoad ();

			SetupNavigationBar ();

			InitRangeSlider ();

			btn_lifeStyle.TitleLabel.Lines = 0;
			btn_homeDetails.TitleLabel.Lines = 0;
			btn_viewResult.Layer.BorderWidth = 1.0f;
			btn_viewResult.Layer.BorderColor = UIColor.LightGray.CGColor;

			var bindingSet = this.CreateBindingSet<SearchView, SearchViewModel> ();
			bindingSet.Bind (loadingView).For(i => i.Hidden).To (vm => vm.IsHideLoading);
			bindingSet.Bind (loadingLabel).To (vm => vm.LoadingText);

			bindingSet.Bind(mPriceRangeSlider.minLabel).To (vm => vm.MinBudgetString);
			bindingSet.Bind(mPriceRangeSlider.maxLabel).To (vm => vm.MaxBudgetString);
			bindingSet.Bind(mPriceRangeSlider.rangeSlider).For ("LeftValueChange").To (vm => vm.MinBudget);
			bindingSet.Bind(mPriceRangeSlider.rangeSlider).For ("RightValueChange").To (vm => vm.MaxBudget);

			bindingSet.Bind (backButton).To (vm => vm.CloseCommand);
			bindingSet.Bind (settingButton).To (vm => vm.SettingCommand);
			bindingSet.Bind (btn_viewResult).To (vm => vm.SearchCommand);

			bindingSet.Bind (btn_propertyTypes).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.PropertyTypes);
			bindingSet.Bind (btn_searchArea).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.SearchArea);
			bindingSet.Bind (btn_inHome).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.InHome);
			bindingSet.Bind (btn_inArea).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.InArea);
//			bindingSet.Bind (btn_homeType).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.HomeType);
			bindingSet.Bind (btn_homeDetails).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.HomeDetails);
			bindingSet.Bind (btn_lifeStyle).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.Lifestyle);
			bindingSet.Bind (btn_savedHome).To (vm => vm.GotoModalCommand).CommandParameter (ThisRoofN.ViewModels.SearchViewModel.ModalType.SavedHome);

			bindingSet.Bind (txt_sortBy).To (vm => vm.SelectedSortType);
			bindingSet.Apply ();


			AlliancePicker picker = new AlliancePicker(this);
			picker.PlainPickerItems = TRConstant.SortTypes.Values.ToList();
			picker.SourceField = txt_sortBy;
			picker.Type = PickerType.List;
			picker.HeaderTitle = "Choose Sort By";
			picker.View.Layer.CornerRadius = 5.0f;

			btn_selectSortBy.TouchUpInside += (object sender, EventArgs e) => {
				picker.Show();
			};
		}

		private void InitRangeSlider ()
		{
			mPriceRangeSlider = new TRMovingLabelRangeSlider (
				new CGRect (0, 0, this.view_rangeSlider.Frame.Width, this.view_rangeSlider.Frame.Height), 
				0, 
				TRConstant.PriceStringValues.Count - 1);

			this.view_rangeSlider.AddSubview (mPriceRangeSlider);
		}

		public override void ViewWillAppear (bool animated)
		{
			base.ViewWillAppear (animated);

			this.NavigationController.SetNavigationBarHidden (false, true);
			this.NavigationController.SetToolbarHidden (true, true);
		}

		public override void ViewDidLayoutSubviews ()
		{
			base.ViewDidLayoutSubviews ();
			if (mPriceRangeSlider != null) {
				mPriceRangeSlider.Frame = new CGRect (0, 0, this.view_rangeSlider.Frame.Width, this.view_rangeSlider.Frame.Height);
			}
		}
	}
}
